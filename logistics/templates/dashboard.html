{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - ShipLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/custom-scrollbars.css' %}">
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #232946 0%, #2193b0 100%);
            overflow-x: hidden;
            transition: background 0.5s;
        }
        .dark-mode body {
            background: linear-gradient(135deg, #232946 0%, #1a1a2e 100%) !important;
        }
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000;
            background: rgba(33, 147, 176, 0.98);
            box-shadow: 0 2px 8px rgba(33,147,176,0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
            padding: 0 32px;
        }
        .dark-mode .sticky-header {
            background: rgba(35, 41, 70, 0.98);
        }
        .header-logo {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
            letter-spacing: 2px;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .dark-mode .header-logo, body.dark-mode .header-logo {
            color: #ffe066;
        }
        .nav {
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        .nav a, .nav button {
            margin-left: 24px;
            background: none;
            border: 2px solid #fff;
            color: #fff;
            padding: 10px 24px;
            border-radius: 24px;
            font-weight: bold;
            text-decoration: none;
            transition: background 0.2s, color 0.2s;
        }
        .nav a:hover, .nav button:hover {
            background: #fff;
            color: #2193b0;
        }
        .dark-mode .nav a, .dark-mode .nav button {
            border: 2px solid #ffe066;
            color: #ffe066;
        }
        .dark-mode .nav a:hover, .dark-mode .nav button:hover {
            background: #ffe066;
            color: #232946;
        }
        .dark-toggle {
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 16px;
            color: #fff;
            transition: color 0.2s;
        }
        .dark-mode .dark-toggle {
            color: #ffe066;
        }
        
        /* Mobile menu styles */
        .mobile-menu-toggle {
            display: none;
            background: none !important;
            border: none !important;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
            margin-left: 0 !important;
        }
        .dark-mode .mobile-menu-toggle {
            color: #ffe066;
            background: none !important;
            border: none !important;
        }
        .mobile-menu-toggle:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            color: #fff !important;
        }
        .dark-mode .mobile-menu-toggle:hover {
            background: rgba(255, 224, 102, 0.1) !important;
            color: #ffe066 !important;
        }
        .mobile-menu-toggle:active,
        .mobile-menu-toggle:focus {
            background: rgba(255, 255, 255, 0.1) !important;
            color: #fff !important;
            outline: none !important;
        }
        .dark-mode .mobile-menu-toggle:active,
        .dark-mode .mobile-menu-toggle:focus {
            background: rgba(255, 224, 102, 0.1) !important;
            color: #ffe066 !important;
            outline: none !important;
        }
        
        .mobile-nav {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            width: 100%;
            background: rgba(33, 147, 176, 0.98);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 999;
            transform: translateY(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .dark-mode .mobile-nav {
            background: rgba(35, 41, 70, 0.98);
        }
        .mobile-nav.active {
            transform: translateY(0);
        }
        .mobile-nav a, .mobile-nav button {
            display: block;
            width: 100%;
            padding: 16px 24px;
            margin: 0;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: none;
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            text-align: left;
            transition: background 0.2s;
        }
        .dark-mode .mobile-nav a, .dark-mode .mobile-nav button {
            color: #ffe066;
            border-bottom: 1px solid rgba(255, 224, 102, 0.1);
        }
        .mobile-nav a:hover, .mobile-nav button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .dark-mode .mobile-nav a:hover, .dark-mode .mobile-nav button:hover {
            background: rgba(255, 224, 102, 0.1);
        }
        .mobile-nav a:last-child, .mobile-nav button:last-child {
            border-bottom: none;
        }
        
        /* Responsive breakpoints */
        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            .mobile-menu-toggle {
                display: block;
            }
            .mobile-nav {
                display: block;
            }
            .sticky-header {
                padding: 0 16px;
            }
            .header-logo {
                font-size: 1.5rem;
            }
            .main-content {
                padding-top: 110px;
            }
            /* Remove custom dashboard grid for 3 columns */
            .dashboard-grid {
                grid-template-columns: 1fr !important;
                gap: 24px !important;
                min-height: auto !important;
            }
            .dashboard-card {
                min-height: 200px !important;
            }
            .dashboard-list {
                max-height: 180px !important;
            }
        }
        
        /* Extra small screens - reduce text and button sizes */
        @media (max-width: 480px) {
            .header-logo {
                font-size: 1.2rem;
            }
            .mobile-nav a, .mobile-nav button {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
            .sticky-header {
                padding: 0 12px;
                height: 60px;
            }
            .mobile-nav {
                top: 60px;
            }
            .main-content {
                padding-top: 80px;
            }
            .dashboard-unified-container {
                padding: 2rem 1.5rem 1.5rem 1.5rem !important;
            }
            .dashboard-stats-card {
                padding: 1.5rem 1rem 1rem 1rem !important;
                font-size: 1rem;
            }
            .dashboard-stats-card div[style*='color:#ffe066'] { 
                font-size: 2rem !important; 
            }
            .dashboard-stats-card div[style*='color:#4fc3f7'] { 
                font-size: 2rem !important; 
            }
            .dashboard-stats-card div[style*='color:#b0b8d1'] { 
                font-size: 0.9rem !important; 
            }
            .dashboard-action-btn {
                font-size: 1rem !important;
                padding: 0.7rem 1.5rem !important;
                min-width: 140px !important;
            }
        }
        
        /* Very small screens - further reduce sizes */
        @media (max-width: 360px) {
            .header-logo {
                font-size: 1rem;
            }
            .mobile-nav a, .mobile-nav button {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            .sticky-header {
                padding: 0 8px;
                height: 55px;
            }
            .mobile-nav {
                top: 55px;
            }
            .main-content {
                padding-top: 70px;
            }
            .dashboard-unified-container {
                padding: 1.5rem 1rem 1rem 1rem !important;
            }
            .dashboard-stats-card {
                padding: 1rem 0.8rem 0.8rem 0.8rem !important;
                font-size: 0.9rem;
            }
            .dashboard-stats-card div[style*='color:#ffe066'] { 
                font-size: 1.5rem !important; 
            }
            .dashboard-stats-card div[style*='color:#4fc3f7'] { 
                font-size: 1.5rem !important; 
            }
            .dashboard-stats-card div[style*='color:#b0b8d1'] { 
                font-size: 0.8rem !important; 
            }
            .dashboard-action-btn {
                font-size: 0.9rem !important;
                padding: 0.6rem 1.2rem !important;
                min-width: 120px !important;
            }
            
            /* Performance optimizations for very small screens */
            .bg-illustration {
                display: none !important;
            }
            .dashboard-action-btn:hover {
                transform: none !important;
                box-shadow: 0 2px 12px rgba(33,147,176,0.10) !important;
            }
            .dashboard-action-btn {
                transition: none !important;
            }
            * {
                animation: none !important;
                transition: none !important;
            }
        }
        
        /* Performance optimizations for small screens */
        @media (max-width: 480px) {
            .bg-illustration {
                opacity: 0.3;
            }
            .dashboard-action-btn:hover {
                transform: translateY(-1px) scale(1.02);
            }
            .dashboard-action-btn {
                transition: box-shadow 0.1s, background 0.1s, color 0.1s, border 0.1s;
            }
            
            /* Simplify dashboard grid on small screens */
            .dashboard-grid {
                grid-template-columns: 1fr !important;
                gap: 24px !important;
                min-height: auto !important;
            }
            .dashboard-card {
                min-height: 200px !important;
            }
            .dashboard-list {
                max-height: 180px !important;
            }
        }
        .main-content {
            padding-top: 90px; /* Height of sticky header + some space */
            padding-bottom: 60px; /* Height of footer + some space */
        }
        @media (max-width: 900px) {
            .nav { padding: 12px 8px 0 8px; }
            .main-content { padding-top: 110px; }
        }
        .footer {
            width: 100vw;
            background: #2193b0;
            color: #fff;
            text-align: center;
            padding: 18px 0 12px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1001;
        }
        .dark-mode .footer {
            background: #232946;
            color: #ffe066;
        }
        .dashboard-action-buttons {
          margin-bottom: 18px;
        }
        .dashboard-action-btn {
          transition: box-shadow 0.18s, background 0.18s, color 0.18s, border 0.18s;
          box-shadow: 0 2px 12px rgba(33,147,176,0.10);
        }
        .dashboard-action-btn:hover {
          box-shadow: 0 6px 24px rgba(33,147,176,0.18);
          transform: translateY(-2px) scale(1.04);
        }
        @media (max-width: 900px) {
          .dashboard-action-buttons { justify-content: center !important; gap: 12px; }
        }
        .dashboard-outer-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .user-info-card {
            background: rgba(30, 36, 60, 0.92);
            backdrop-filter: blur(16px);
            border-radius: 28px;
            box-shadow: 0 8px 40px rgba(33,147,176,0.22);
            min-width: 260px;
            max-width: 400px;
            font-size: 1.15rem;
            padding: 2.5rem 2rem 2rem 2rem;
            color: #fff;
        }
        .profile-pic {
            background: #4fc3f7;
            color: #fff;
            box-shadow: 0 2px 8px rgba(33,147,176,0.10);
            width: 90px;
            height: 90px;
            font-size: 2.7rem;
        }
        .dashboard-stats-card {
            background: rgba(20, 24, 40, 0.98);
            backdrop-filter: blur(18px);
            border-radius: 32px;
            box-shadow: 0 16px 64px rgba(33,147,176,0.22);
            color: #fff;
            font-size: 1.25rem;
            padding: 2.5rem 2.5rem 2rem 2.5rem !important;
        }
        .dashboard-stats-card div[style*='color:#ffe066'] { color: #ffe066 !important; font-size: 2.5rem !important; }
        .dashboard-stats-card div[style*='color:#4fc3f7'] { color: #4fc3f7 !important; font-size: 2.5rem !important; }
        .dashboard-stats-card div[style*='color:#b0b8d1'] { color: #b0b8d1 !important; font-size: 1.1rem !important; }
        .dashboard-action-btn.btn-warning {
            background: #ffe066;
            color: #232946;
            border: none;
            font-size: 1.18rem;
            padding: 0.9rem 2.2rem;
        }
        .dashboard-action-btn.btn-warning:hover {
            background: #ffea94;
            color: #232946;
        }
        .dashboard-action-btn.btn-outline-info {
            border: 2px solid #4fc3f7;
            color: #4fc3f7;
            background: transparent;
            font-size: 1.18rem;
            padding: 0.9rem 2.2rem;
        }
        .dashboard-action-btn.btn-outline-info:hover {
            background: #4fc3f7;
            color: #232946;
        }
        .dashboard-grid {
            background: none;
            box-shadow: none;
            border-radius: 0;
            padding: 0 !important;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 40px 40px;
            justify-content: center;
        }
        .dashboard-card {
            background: rgba(35, 41, 70, 0.97);
            border-radius: 28px;
            box-shadow: 0 8px 40px rgba(33,147,176,0.18);
            color: #fff;
            transition: box-shadow 0.18s, transform 0.18s;
            font-size: 1.18rem;
            padding: 2.2rem 2rem 1.7rem 2rem;
            min-width: 340px;
            max-width: 520px;
            flex: 1 1 420px;
        }
        .dashboard-card:hover {
            box-shadow: 0 16px 48px rgba(33,147,176,0.28) !important;
            transform: translateY(-6px) scale(1.035);
        }
        .dashboard-list {
            scrollbar-width: thin;
            scrollbar-color: #4fc3f7 #232946;
        }
        .dashboard-list::-webkit-scrollbar {
            width: 8px;
            background: #232946;
            border-radius: 8px;
        }
        .dashboard-list::-webkit-scrollbar-thumb {
            background: #4fc3f7;
            border-radius: 8px;
        }
        .fw-bold[style*='color:#2193b0'] { color: #4fc3f7 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#1976d2'] { color: #2193b0 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#4fc3f7'] { color: #ffe066 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#ff9800'] { color: #ffe066 !important; font-size: 1.25rem !important; }
        .badge.bg-warning.text-dark { background: #ffe066 !important; color: #232946 !important; font-size: 1.05rem !important; }
        .dashboard-list-item a.view-details-link {
            color: #4fc3f7;
            font-weight: 500;
            text-decoration: none;
            transition: color 0.18s;
            font-size: 1.08rem;
        }
        .dashboard-list-item a.view-details-link:hover {
            color: #ffe066;
            text-decoration: underline;
        }
        @media (max-width: 1400px) {
            .dashboard-grid { max-width: 98vw; padding: 32px 8px 24px 8px !important; }
        }
        @media (max-width: 900px) {
            .dashboard-outer-container { padding: 12px 0 32px 0; }
            .dashboard-stats-card { flex-direction: column !important; gap: 18px !important; align-items: center !important; }
            .user-info-card { margin-bottom: 18px; }
            .dashboard-grid { padding: 18px 2px 12px 2px !important; }
        }
        @media (max-width: 600px) {
            .dashboard-outer-container { padding: 0 0 24px 0; }
            .dashboard-stats-card, .dashboard-card { padding: 18px 8px 14px 8px !important; }
            .dashboard-grid { padding: 8px 2px 8px 2px !important; }
        }
        @media (max-width: 1200px) {
          .dashboard-grid { grid-template-columns: 1fr !important; grid-template-rows: none !important; }
        }
        @media (max-width: 900px) {
          .dashboard-grid { grid-template-columns: 1fr !important; gap: 28px 0 !important; }
          .dashboard-card { min-width: 0 !important; max-width: 100vw !important; }
        }
        .dashboard-list-item.clickable-item {
          transition: background 0.18s, box-shadow 0.18s;
        }
        .dashboard-list-item.clickable-item:hover {
          background: rgba(79, 195, 247, 0.13);
          box-shadow: 0 2px 12px rgba(79, 195, 247, 0.12);
          border-radius: 10px;
        }

/* Light mode overrides - brighter, lighter */
body.light-mode {
  background: linear-gradient(135deg, #fafdff 0%, #d6f0fa 100%) !important;
            color: #232946;
        }
body.light-mode .dashboard-unified-container,
body.light-mode .dashboard-card,
body.light-mode .dashboard-stats-card,
body.light-mode .modal-content {
  background: #fff !important;
  color: #232946 !important;
  box-shadow: 0 4px 24px rgba(33,147,176,0.08);
  border-radius: 28px;
}
body.light-mode .dashboard-stats-card {
  background: #f3faff !important;
}
body.light-mode .dashboard-list-item.clickable-item:hover {
  background: #e3f6fc !important;
}
body.light-mode .fw-bold,
body.light-mode .fw-bold[style*='color:#4fc3f7'],
body.light-mode .fw-bold[style*='color:#ffe066'],
body.light-mode .fw-bold[style*='color:#2193b0'] {
  color: #2193b0 !important;
}
body.light-mode .fw-bold[style*='color:#ffe066'],
body.light-mode .fw-bold[style*='color:#ff9800'] {
  color: #f6c90e !important;
}
body.light-mode .badge.bg-warning.text-dark {
  background: #ffe066 !important;
  color: #232946 !important;
}
body.light-mode .badge.bg-success {
  background: #27ae60 !important;
            color: #fff !important;
        }
body.light-mode .badge.bg-danger {
  background: #e74c3c !important;
            color: #fff !important;
        }
body.light-mode .dashboard-list-item {
  color: #232946 !important;
}
body.light-mode .dashboard-list {
  scrollbar-color: #b0e0e6 #e3f6fc;
}
body.light-mode .dashboard-list::-webkit-scrollbar-thumb {
  background: #b0e0e6;
}
        .modal-content .form-text { color: #fff !important; }
        
        /* Success Modal Styling */
        #successMessageModal .modal-content {
            background: rgba(35, 41, 70, 0.98) !important;
            color: #fff !important;
            border-radius: 18px !important;
            box-shadow: 0 8px 40px rgba(33, 147, 176, 0.18) !important;
        }
        
        #successMessageModal .modal-header {
            border-bottom: none !important;
        }
        
        #successMessageModal .modal-title {
            color: #ffe066 !important;
            font-weight: bold !important;
        }
        
        #successMessageModal .btn-warning {
            background: #ffe066 !important;
            color: #232946 !important;
            border: none !important;
            font-weight: bold !important;
        }
        
        #successMessageModal .btn-warning:hover {
            background: #ffea94 !important;
            color: #232946 !important;
        }
        
        /* Light mode overrides for success modal */
        body.light-mode #successMessageModal .modal-content {
            background: #fff !important;
            color: #232946 !important;
        }
        
        body.light-mode #successMessageModal .modal-title {
            color: #2193b0 !important;
        }
        
        body.light-mode #successMessageModal .btn-warning {
            background: #ffe066 !important;
            color: #232946 !important;
        }
    </style>
</head>
<body>
    <header class="sticky-header">
        <div class="header-logo">ShipLink</div>
        
        <!-- Desktop Navigation -->
        <nav class="nav">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="/contact">Contact</a>
            {% if user.is_authenticated %}
                <a href="{% url 'logistics:dashboard' %}">Dashboard</a>
                <a href="{% url 'logistics:logout' %}">Logout</a>
            {% else %}
                <a href="/login">Login</a>
                <a href="/register">Register</a>
            {% endif %}
            <button class="dark-toggle" id="darkModeToggle" title="Toggle dark mode">üåô</button>
        </nav>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" title="Toggle mobile menu">
            ‚ò∞
        </button>
    </header>
    
    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
        {% if user.is_authenticated %}
            <a href="{% url 'logistics:dashboard' %}">Dashboard</a>
            <a href="{% url 'logistics:logout' %}">Logout</a>
        {% else %}
            <a href="/login">Login</a>
            <a href="/register">Register</a>
        {% endif %}
        <button class="dark-toggle" id="mobileDarkModeToggle" title="Toggle dark mode">üåô</button>
    </nav>
    <div class="main-content" style="position:relative;">
        <!-- Floating SVG background -->
        <svg class="bg-illustration" viewBox="0 0 1600 900" fill="none" xmlns="http://www.w3.org/2000/svg" style="position:absolute;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:1;">
          <circle cx="200" cy="180" r="48" fill="#4fc3f7" fill-opacity="0.18">
            <animate attributeName="cy" values="180;220;180" dur="8s" repeatCount="indefinite"/>
          </circle>
          <rect x="1350" y="120" width="60" height="60" rx="18" fill="#ffe066" fill-opacity="0.13">
            <animate attributeName="y" values="120;160;120" dur="10s" repeatCount="indefinite"/>
          </rect>
          <ellipse cx="800" cy="700" rx="120" ry="40" fill="#2193b0" fill-opacity="0.10">
            <animate attributeName="cx" values="800;900;800" dur="12s" repeatCount="indefinite"/>
          </ellipse>
          <circle cx="1400" cy="600" r="32" fill="#4fc3f7" fill-opacity="0.15">
            <animate attributeName="cy" values="600;640;600" dur="7s" repeatCount="indefinite"/>
          </circle>
          <rect x="300" y="700" width="80" height="32" rx="12" fill="#ffe066" fill-opacity="0.10">
            <animate attributeName="x" values="300;350;300" dur="11s" repeatCount="indefinite"/>
          </rect>
        </svg>
        <!-- Success Message Modal -->
        {% if messages %}
        <div class="modal fade" id="successMessageModal" tabindex="-1" aria-labelledby="successMessageModalLabel" aria-hidden="true" data-bs-backdrop="true" data-bs-keyboard="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:rgba(35,41,70,0.98);color:#fff;border-radius:18px;box-shadow:0 8px 40px rgba(33,147,176,0.18);">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="successMessageModalLabel">Success!</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center">
                {% for message in messages %}
                  {% if forloop.first %}
                  <div class="d-flex align-items-center justify-content-center mb-3">
                    <span style="font-size: 3rem; margin-right: 1rem;">
                      {% if message.level_tag == 'error' %}‚ùå{% else %}‚úÖ{% endif %}
                    </span>
                    <span style="font-size: 1.2rem; font-weight: bold;">{{ message }}</span>
                  </div>
                  {% endif %}
                {% endfor %}
                <div class="mt-4">
                  <button type="button" class="btn btn-warning" data-bs-dismiss="modal" style="border-radius: 12px; padding: 10px 24px; font-weight: bold;">Continue</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
        
        <!-- Unified Dashboard Container -->
        <div class="dashboard-unified-container mx-auto d-flex flex-column align-items-center justify-content-center" style="max-width:1400px;width:98vw;background:rgba(30,36,60,0.93);backdrop-filter:blur(18px);border-radius:36px;box-shadow:0 16px 64px rgba(33,147,176,0.22);padding:3.5rem 2.5rem 2.5rem 2.5rem;">
          <!-- User Info Row -->
          <div class="d-flex flex-column flex-md-row align-items-center justify-content-between w-100 mb-4 gap-4">
            <div class="d-flex align-items-center gap-3">
              <div class="profile-pic" style="width:90px;height:90px;border-radius:50%;background:#4fc3f7;display:flex;align-items:center;justify-content:center;font-size:2.7rem;font-weight:bold;color:#fff;box-shadow:0 2px 8px rgba(33,147,176,0.10);">
                {% if user.profile.avatar %}
                  <img src="{{ user.profile.avatar.url }}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                {% else %}
                  {{ user.username|first|upper }}
                {% endif %}
            </div>
              <div>
                <div class="fw-bold" style="font-size:1.35rem;color:#fff;">{{ user.username }}</div>
                <div class="text-muted" style="font-size:1.05rem;">user</div>
                                </div>
                                </div>
            <div class="d-flex flex-row gap-2 mt-3 mt-md-0">
              <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Info</button>
              <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change Password</button>
                            </div>
                            </div>
          <!-- Stats Bar -->
          <div class="dashboard-stats-card mb-4 w-100 d-flex flex-row justify-content-between align-items-center" style="background:rgba(20,24,40,0.98);backdrop-filter:blur(18px);border-radius:32px;box-shadow:0 16px 64px rgba(33,147,176,0.22);color:#fff;font-size:1.25rem;padding:2.5rem 2.5rem 2rem 2.5rem !important;gap:32px;">
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#ffe066;">{{ live_jobs_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Live Jobs</div>
                    </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#4fc3f7;">{{ active_requests_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Active Requests</div>
            </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#ffe066;">{{ jobs_booked_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Jobs Booked</div>
        </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#4fc3f7;">{{ liked_jobs_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Liked Jobs</div>
                                </div>
                                </div>
          <!-- Action Buttons -->
          <div class="dashboard-action-buttons d-flex flex-row justify-content-md-end justify-content-center align-items-center mb-4 gap-3 w-100">
            <a href="{% url 'logistics:request_job' %}" class="btn btn-lg btn-outline-info fw-bold shadow-sm dashboard-action-btn" style="border-radius: 22px; min-width: 160px; font-size: 1.13rem;">Request Job</a>
            <a href="{% url 'logistics:job_list' %}" class="btn btn-lg btn-outline-info fw-bold shadow-sm dashboard-action-btn" style="border-radius: 22px; min-width: 160px; font-size: 1.13rem;">Browse Jobs</a>
                            </div>
          <!-- Dashboard Grid -->
          <div class="dashboard-grid w-100 d-grid" style="grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 48px 48px; min-height: 480px; width: 100vw; max-width: 1600px; margin: 0 auto;">
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#4fc3f7;font-size:1.25rem;">My Job Requests</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for request in job_requests %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ request.id }}" data-type="request" style="cursor:pointer;">
                    <span>
                      {{ request.title }}
                      <span class="badge ms-2
                        {% if request.status == 'pending' %}bg-warning text-dark
                        {% elif request.status == 'approved' %}bg-success
                        {% elif request.status == 'rejected' %}bg-danger
                        {% endif %}">
                        {{ request.status|capfirst }}
                      </span>
                    </span>
                            </div>
                {% empty %}
                  <div class="text-muted">No job requests found.</div>
                        {% endfor %}
                            </div>
                    </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#2193b0;font-size:1.25rem;">Booked Jobs</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for booked in booked_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ booked.job.id }}" data-type="job" style="cursor:pointer;">
                    <span>
                      {{ booked.job.title }}
                    </span>
            </div>
                {% empty %}
                  <div class="text-muted">No booked jobs found.</div>
                    {% endfor %}
                    </div>
            </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#ffe066;font-size:1.25rem;">Liked Jobs</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                    {% for job in liked_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ job.id }}" data-type="job" style="cursor:pointer; position:relative;">
                    <!-- Booking Status Badge -->
                    {% if job.id in booked_jobs.values_list.0 %}
                    <div style="position:absolute; top:2px; right:2px; background:#27ae60; color:white; padding:2px 6px; border-radius:8px; font-size:10px; font-weight:bold; z-index:10;">
                        ‚úì
                    </div>
                    {% endif %}
                    <span>
                      {{ job.title }}
                    </span>
                            </div>
                {% empty %}
                  <div class="text-muted">No liked jobs found.</div>
                    {% endfor %}
                    </div>
            </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2 d-flex align-items-center" style="color:#ffe066;font-size:1.25rem;"><span style="font-size:1.2rem;">&#128161;</span><span class="ms-2">Recommended Jobs</span></div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                    {% for job in recommended_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ job.id }}" data-type="job" style="cursor:pointer; position:relative;">
                    <!-- Booking Status Badge -->
                    {% if job.id in booked_jobs.values_list.0 %}
                    <div style="position:absolute; top:2px; right:2px; background:#27ae60; color:white; padding:2px 6px; border-radius:8px; font-size:10px; font-weight:bold; z-index:10;">
                        ‚úì
                    </div>
                    {% endif %}
                    <span>
                      {{ job.title }}
                    </span>
                            </div>
                {% empty %}
                  <div class="text-muted">No recommended jobs found.</div>
                {% endfor %}
                                </div>
                                </div>
                            </div>
                            </div>
        </div>
      </div>
    <footer class="footer">
  ¬© 2024 ShipLink. All rights reserved.
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Job Detail Modal -->
    <div id="jobDetailModal" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(30,34,40,0.82); align-items:center; justify-content:center;">
      <div class="modal-content" style="background:#fff; color:#232946; border-radius:18px; max-width:90vw; width:90vw; max-height:90vh; height:90vh; padding:0; box-shadow:0 8px 40px rgba(52,152,219,0.18); position:relative; display:flex; flex-direction:column; overflow:hidden;">
        <div style="padding:24px 32px 0 32px; border-bottom:1px solid #eee; flex-shrink:0;">
          <button onclick="closeJobDetailModal()" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:2rem; color:#888; cursor:pointer;">&times;</button>
          <h3 style="margin:0; color:#4fc3f7; font-size:1.8rem;">üöö Job Details</h3>
        </div>
        <div id="jobDetailContent" style="flex:1 1 auto; overflow-y:auto; padding:24px 32px 32px 32px;">
          <!-- Job details will be loaded here -->
        </div>
        <div id="jobDetailActionBox" style="display:none;"></div>
      </div>
    </div>
    
    <style>
    /* Dark theme styles for job detail modal */
    .dark-mode #jobDetailModal .modal-content {
        background: rgba(35,41,70,0.98) !important;
        color: #fff !important;
        box-shadow: 0 8px 40px rgba(33,147,176,0.18) !important;
    }
    
    .dark-mode #jobDetailModal .modal-content > div:first-child {
        border-bottom-color: #444 !important;
    }
    
    .dark-mode #jobDetailModal button {
        color: #ccc !important;
    }
    
    .dark-mode #jobDetailModal button:hover {
        color: #fff !important;
    }
    
    .dark-mode #jobDetailModal h3 {
        color: #4fc3f7 !important;
    }
    
    /* Dark theme for modal content sections */
    .dark-mode #jobDetailModal .section-bg {
        background: rgba(255,255,255,0.05) !important;
        border: 1px solid rgba(255,255,255,0.1) !important;
    }
    
    .dark-mode #jobDetailModal .section-title {
        color: #4fc3f7 !important;
    }
    
    .dark-mode #jobDetailModal .route-title {
        color: #ffe066 !important;
    }
    
    .dark-mode #jobDetailModal .timing-title {
        color: #27ae60 !important;
    }
    
    .dark-mode #jobDetailModal .cargo-title {
        color: #e74c3c !important;
    }
    
    .dark-mode #jobDetailModal .financial-title {
        color: #9b59b6 !important;
    }
    
    .dark-mode #jobDetailModal .stats-title {
        color: #3498db !important;
    }
    
    .dark-mode #jobDetailModal .info-title {
        color: #95a5a6 !important;
    }
    
    .dark-mode #jobDetailModal .staff-title {
        color: #3498db !important;
    }
    </style>
    
    <script>
    function setDarkMode(on) {
        if(on) {
            document.documentElement.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'on');
        } else {
            document.documentElement.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'off');
        }
    }
    function getDarkMode() {
        const pref = localStorage.getItem('darkMode');
        if (pref === null) {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        return pref === 'on';
    }
    document.getElementById('darkModeToggle').onclick = function() {
        const on = !getDarkMode();
        setDarkMode(on);
        this.textContent = on ? '‚òÄÔ∏è' : 'üåô';
    };
    setDarkMode(getDarkMode());
    document.getElementById('darkModeToggle').textContent = getDarkMode() ? '‚òÄÔ∏è' : 'üåô';
    
    // Auto-show success message modal if messages exist
    document.addEventListener('DOMContentLoaded', function() {
        const successModal = document.getElementById('successMessageModal');
        if (successModal) {
            // Small delay to ensure page is fully loaded
            setTimeout(function() {
                const modal = new bootstrap.Modal(successModal);
                modal.show();
            }, 300);
        }
    });
    </script>
    <script>
// Job Detail Modal Functions
function openJobDetailModal(id, type) {
    document.getElementById('jobDetailModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
    const url = type === 'request' ? `/requests/${id}/json/` : `/jobs/${id}/json/`;
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            const isDarkMode = getDarkMode();
            const bgColor = isDarkMode ? 'rgba(255,255,255,0.05)' : 'rgba(79, 195, 247, 0.1)';
            const borderColor = isDarkMode ? 'rgba(255,255,255,0.1)' : 'transparent';
            
            let html = '';
            if (type === 'job') {
                // Job details layout
                html = `<div style="display: flex; gap: 24px; height: 100%;">
                  <!-- Left Column -->
                  <div style="flex: 1; display: flex; flex-direction: column; gap: 16px;">
                    <!-- Basic Information Section -->
                    <div class="section-bg" style="background: ${bgColor}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="section-title" style="color: #4fc3f7; margin-bottom: 12px; font-size: 1.1rem;">üìù Basic Information</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Title:</span> ${data.title || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Description:</span> ${data.description || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Reference Code:</span> ${data.reference_code || '‚Äî'}</div>
                    </div>
                    <!-- Route Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(255,224,102,0.1)' : 'rgba(255, 224, 102, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="route-title" style="color: #ffe066; margin-bottom: 12px; font-size: 1.1rem;">üó∫Ô∏è Route Information</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Origin:</span> ${data.origin} ${data.origin_address ? `(${data.origin_address}, ${data.origin_zip || ''})` : ''}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Destination:</span> ${data.destination} ${data.destination_address ? `(${data.destination_address}, ${data.destination_zip || ''})` : ''}</div>
                    </div>
                    <!-- Timing Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(39, 174, 96, 0.2)' : 'rgba(39, 174, 96, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="timing-title" style="color: #27ae60; margin-bottom: 12px; font-size: 1.1rem;">‚è∞ Timing Details</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Pickup Date:</span> ${data.pickup_date || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Pickup Time:</span> ${data.pickup_time_from || '‚Äî'} - ${data.pickup_time_to || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Delivery Deadline:</span> ${data.delivery_deadline || '‚Äî'}</div>
                    </div>
                  </div>
                  <!-- Right Column -->
                  <div style="flex: 1; display: flex; flex-direction: column; gap: 16px;">
                    <!-- Cargo Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(231, 76, 60, 0.2)' : 'rgba(231, 76, 60, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="cargo-title" style="color: #e74c3c; margin-bottom: 12px; font-size: 1.1rem;">üì¶ Cargo Details</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Cargo Type:</span> ${data.cargo_type || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Dimensions:</span> ${data.length_cm || '‚Äî'} √ó ${data.width_cm || '‚Äî'} √ó ${data.height_cm || '‚Äî'} cm</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Special Requirements:</span> ${data.special_requirements || '‚Äî'}</div>
                    </div>
                    <!-- Job Statistics Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(52, 152, 219, 0.2)' : 'rgba(52, 152, 219, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="stats-title" style="color: #3498db; margin-bottom: 12px; font-size: 1.1rem;">üìä Job Statistics</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Likes:</span> ${data.like_count || '0'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Booked:</span> ${data.booked ? 'Yes' : 'No'}</div>
                    </div>
                    <!-- Creation Information -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(149, 165, 166, 0.2)' : 'rgba(149, 165, 166, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="info-title" style="color: #95a5a6; margin-bottom: 12px; font-size: 1.1rem;">üìÖ Job Information</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Posted:</span> ${data.created_at || '‚Äî'}</div>
                    </div>
                  </div>
                </div>`;
            } else {
                // Job request details layout
                html = `<div style="display: flex; gap: 24px; height: 100%;">
                  <!-- Left Column -->
                  <div style="flex: 1; display: flex; flex-direction: column; gap: 16px;">
                    <!-- Status Badge -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(39, 174, 96, 0.2)' : 'rgba(39, 174, 96, 0.1)'}; padding: 16px; border-radius: 12px; text-align: center; border: 1px solid ${borderColor};">
                      <span class="badge ${data.status === 'pending' ? 'bg-warning text-dark' : data.status === 'approved' ? 'bg-success' : 'bg-danger'}" style="font-size: 1rem; padding: 8px 16px;">${data.status || '‚Äî'}</span>
                    </div>
                    <!-- Basic Information Section -->
                    <div class="section-bg" style="background: ${bgColor}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="section-title" style="color: #4fc3f7; margin-bottom: 12px; font-size: 1.1rem;">üìù Basic Information</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Title:</span> ${data.title || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Description:</span> ${data.description || '‚Äî'}</div>
                    </div>
                    <!-- Route Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(255,224,102,0.1)' : 'rgba(255, 224, 102, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="route-title" style="color: #ffe066; margin-bottom: 12px; font-size: 1.1rem;">üöö Route Information</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Origin:</span> ${data.origin} ${data.origin_address ? `(${data.origin_address}, ${data.origin_zip || ''})` : ''}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Destination:</span> ${data.destination} ${data.destination_address ? `(${data.destination_address}, ${data.destination_zip || ''})` : ''}</div>
                    </div>
                    <!-- Timing Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(39, 174, 96, 0.2)' : 'rgba(39, 174, 96, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="timing-title" style="color: #27ae60; margin-bottom: 12px; font-size: 1.1rem;">‚è∞ Timing Details</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Pickup Date:</span> ${data.pickup_date || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Pickup Time Window:</span> ${data.pickup_time_from || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Dropoff Time Window:</span> ${data.pickup_time_to || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Delivery Deadline:</span> ${data.delivery_deadline || '‚Äî'}</div>
                    </div>
                  </div>
                  <!-- Right Column -->
                  <div style="flex: 1; display: flex; flex-direction: column; gap: 16px;">
                    <!-- Cargo Information Section -->
                    <div class="section-bg" style="background: ${isDarkMode ? 'rgba(231, 76, 60, 0.2)' : 'rgba(231, 76, 60, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                      <h6 class="cargo-title" style="color: #e74c3c; margin-bottom: 12px; font-size: 1.1rem;">üì¶ Cargo Details</h6>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Cargo Type:</span> ${data.cargo_type || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Number of Boxes:</span> ${data.num_boxes || '‚Äî'}</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Box Dimensions:</span> ${data.length_per_box_cm || '‚Äî'} √ó ${data.width_per_box_cm || '‚Äî'} √ó ${data.height_per_box_cm || '‚Äî'} cm</div>
                      <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Special Requirements:</span> ${data.special_requirements || '‚Äî'}</div>
                    </div>`;
                // Show approved value if available and status is approved
                if (data.status === 'approved' && data.approved_value) {
                  html += `<div style="margin-bottom: 10px;"><span style="font-weight: bold; color: #27ae60;">Approved Value:</span> ${data.approved_value}</div>`;
                }
                html += `</div>`;
                
                // Staff Information Section (if available)
                if (data.staff_note) {
                  html += `<div class="section-bg" style="background: ${isDarkMode ? 'rgba(52, 152, 219, 0.2)' : 'rgba(52, 152, 219, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                    <h6 class="staff-title" style="color: #3498db; margin-bottom: 12px; font-size: 1.1rem;">üë®‚Äçüíº Staff Notes</h6>
                    <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Notes:</span> ${data.staff_note}</div>
                  </div>`;
                }
                
                // Creation Information
                html += `<div class="section-bg" style="background: ${isDarkMode ? 'rgba(149, 165, 166, 0.2)' : 'rgba(149, 165, 166, 0.1)'}; padding: 20px; border-radius: 12px; border: 1px solid ${borderColor};">
                  <h6 class="info-title" style="color: #95a5a6; margin-bottom: 12px; font-size: 1.1rem;">üìÖ Request Information</h6>
                  <div style="margin-bottom: 10px;"><span style="font-weight: bold;">Created:</span> ${data.created_at || '‚Äî'}</div>
                </div>`;
                html += `</div></div>`;
            }
            
            document.getElementById('jobDetailContent').innerHTML = html;
            
            // Hide action box for dashboard (no booking/liking needed)
            document.getElementById('jobDetailActionBox').style.display = 'none';
        })
        .catch(error => {
            document.getElementById('jobDetailContent').innerHTML = '<div style="color:#e74c3c;">Error loading details. Please try again.</div>';
            document.getElementById('jobDetailActionBox').style.display = 'none';
        });
}

function closeJobDetailModal() {
    document.getElementById('jobDetailModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close modal on click outside or Escape
window.onclick = function(event) {
    const modal = document.getElementById('jobDetailModal');
    if (event.target === modal) closeJobDetailModal();
};

document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') closeJobDetailModal();
});

// Update click handlers for dashboard items
document.addEventListener('DOMContentLoaded', function() {
    // Handle job requests
    document.querySelectorAll('.clickable-item[data-type="request"]').forEach(item => {
        item.addEventListener('click', function(e) {
            const id = this.getAttribute('data-id');
            openJobDetailModal(id, 'request');
        });
    });
    
    // Handle jobs (booked, liked, recommended)
    document.querySelectorAll('.clickable-item[data-type="job"]').forEach(item => {
        item.addEventListener('click', function(e) {
            const id = this.getAttribute('data-id');
            openJobDetailModal(id, 'job');
        });
    });
});
    </script>
<script>
// AJAX for Edit Profile Modal
$(document).ready(function() {
  $('#editProfileForm').on('submit', function(e) {
    e.preventDefault();
    var $form = $(this);
    var $msg = $('#editProfileMsg');
    $.ajax({
      url: $form.attr('action'),
      type: 'POST',
      data: $form.serialize(),
      success: function(data) {
        if (data.success) {
          $msg.html('<div class="alert alert-success">Profile updated!</div>');
          setTimeout(function() { $('#editProfileModal').modal('hide'); location.reload(); }, 1200);
        } else {
          $msg.html('<div class="alert alert-danger">' + (data.error || 'Update failed.') + '</div>');
        }
      },
      error: function(xhr) {
        $msg.html('<div class="alert alert-danger">' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Update failed.') + '</div>');
      }
    });
  });
});
</script>
<script>
// AJAX for Change Password Modal
$(document).ready(function() {
  $('#changePasswordForm').on('submit', function(e) {
    e.preventDefault();
    var $form = $(this);
    var $msg = $('#changePasswordMsg');
    $.ajax({
      url: $form.attr('action'),
      type: 'POST',
      data: $form.serialize(),
      success: function(data) {
        if (data.success) {
          $msg.html('<div class="alert alert-success">Password changed!</div>');
          setTimeout(function() { $('#changePasswordModal').modal('hide'); location.reload(); }, 1200);
        } else {
          $msg.html('<div class="alert alert-danger">' + (data.error || 'Change failed.') + '</div>');
        }
      },
      error: function(xhr) {
        $msg.html('<div class="alert alert-danger">' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Change failed.') + '</div>');
      }
    });
  });
});
    </script>
    <script>
    // Mobile menu functionality
    function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobileNav');
        mobileNav.classList.toggle('active');
    }
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', function(event) {
        const mobileNav = document.getElementById('mobileNav');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        
        if (!mobileNav.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
            mobileNav.classList.remove('active');
        }
    });
    
    // Close mobile menu when clicking on a link
    document.querySelectorAll('.mobile-nav a').forEach(link => {
        link.addEventListener('click', function() {
            document.getElementById('mobileNav').classList.remove('active');
        });
    });
    
    // Mobile menu toggle
    document.getElementById('mobileMenuToggle').onclick = function() {
        toggleMobileMenu();
    };
    
    // Dark mode toggle functionality for mobile
    document.getElementById('mobileDarkModeToggle').onclick = function() {
        const on = !getDarkMode();
        setDarkMode(on);
        this.textContent = on ? '‚òÄÔ∏è' : 'üåô';
        document.getElementById('darkModeToggle').textContent = on ? '‚òÄÔ∏è' : 'üåô';
    };
    
    // Initialize mobile dark mode toggle
    const darkModeIcon = getDarkMode() ? '‚òÄÔ∏è' : 'üåô';
    document.getElementById('mobileDarkModeToggle').textContent = darkModeIcon;
    </script>
</body>
</html> 