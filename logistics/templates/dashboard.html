<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - ShipLink</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #232946 0%, #2193b0 100%);
            overflow-x: hidden;
            transition: background 0.5s;
        }
        .dark-mode body {
            background: linear-gradient(135deg, #232946 0%, #1a1a2e 100%) !important;
        }
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000;
            background: rgba(33, 147, 176, 0.98);
            box-shadow: 0 2px 8px rgba(33,147,176,0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
            padding: 0 32px;
        }
        .dark-mode .sticky-header {
            background: rgba(35, 41, 70, 0.98);
        }
        .header-logo {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
            letter-spacing: 2px;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .dark-mode .header-logo, body.dark-mode .header-logo {
            color: #ffe066;
        }
        .nav {
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        .nav a, .nav button {
            margin-left: 24px;
            background: none;
            border: 2px solid #fff;
            color: #fff;
            padding: 10px 24px;
            border-radius: 24px;
            font-weight: bold;
            text-decoration: none;
            transition: background 0.2s, color 0.2s;
        }
        .nav a:hover, .nav button:hover {
            background: #fff;
            color: #2193b0;
        }
        .dark-mode .nav a, .dark-mode .nav button {
            border: 2px solid #ffe066;
            color: #ffe066;
        }
        .dark-mode .nav a:hover, .dark-mode .nav button:hover {
            background: #ffe066;
            color: #232946;
        }
        .dark-toggle {
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 16px;
            color: #fff;
            transition: color 0.2s;
        }
        .dark-mode .dark-toggle {
            color: #ffe066;
        }
        .main-content {
            padding-top: 90px; /* Height of sticky header + some space */
            padding-bottom: 60px; /* Height of footer + some space */
        }
        @media (max-width: 900px) {
            .nav { padding: 12px 8px 0 8px; }
            .main-content { padding-top: 110px; }
        }
        .footer {
            width: 100vw;
            background: #2193b0;
            color: #fff;
            text-align: center;
            padding: 18px 0 12px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1001;
        }
        .dark-mode .footer {
            background: #232946;
            color: #ffe066;
        }
        .dashboard-action-buttons {
          margin-bottom: 18px;
        }
        .dashboard-action-btn {
          transition: box-shadow 0.18s, background 0.18s, color 0.18s, border 0.18s;
          box-shadow: 0 2px 12px rgba(33,147,176,0.10);
        }
        .dashboard-action-btn:hover {
          box-shadow: 0 6px 24px rgba(33,147,176,0.18);
          transform: translateY(-2px) scale(1.04);
        }
        @media (max-width: 900px) {
          .dashboard-action-buttons { justify-content: center !important; gap: 12px; }
        }
        .dashboard-outer-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .user-info-card {
            background: rgba(30, 36, 60, 0.92);
            backdrop-filter: blur(16px);
            border-radius: 28px;
            box-shadow: 0 8px 40px rgba(33,147,176,0.22);
            min-width: 260px;
            max-width: 400px;
            font-size: 1.15rem;
            padding: 2.5rem 2rem 2rem 2rem;
            color: #fff;
        }
        .profile-pic {
            background: #4fc3f7;
            color: #fff;
            box-shadow: 0 2px 8px rgba(33,147,176,0.10);
            width: 90px;
            height: 90px;
            font-size: 2.7rem;
        }
        .dashboard-stats-card {
            background: rgba(20, 24, 40, 0.98);
            backdrop-filter: blur(18px);
            border-radius: 32px;
            box-shadow: 0 16px 64px rgba(33,147,176,0.22);
            color: #fff;
            font-size: 1.25rem;
            padding: 2.5rem 2.5rem 2rem 2.5rem !important;
        }
        .dashboard-stats-card div[style*='color:#ffe066'] { color: #ffe066 !important; font-size: 2.5rem !important; }
        .dashboard-stats-card div[style*='color:#4fc3f7'] { color: #4fc3f7 !important; font-size: 2.5rem !important; }
        .dashboard-stats-card div[style*='color:#b0b8d1'] { color: #b0b8d1 !important; font-size: 1.1rem !important; }
        .dashboard-action-btn.btn-warning {
            background: #ffe066;
            color: #232946;
            border: none;
            font-size: 1.18rem;
            padding: 0.9rem 2.2rem;
        }
        .dashboard-action-btn.btn-warning:hover {
            background: #ffea94;
            color: #232946;
        }
        .dashboard-action-btn.btn-outline-info {
            border: 2px solid #4fc3f7;
            color: #4fc3f7;
            background: transparent;
            font-size: 1.18rem;
            padding: 0.9rem 2.2rem;
        }
        .dashboard-action-btn.btn-outline-info:hover {
            background: #4fc3f7;
            color: #232946;
        }
        .dashboard-grid {
            background: none;
            box-shadow: none;
            border-radius: 0;
            padding: 0 !important;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 40px 40px;
            justify-content: center;
        }
        .dashboard-card {
            background: rgba(35, 41, 70, 0.97);
            border-radius: 28px;
            box-shadow: 0 8px 40px rgba(33,147,176,0.18);
            color: #fff;
            transition: box-shadow 0.18s, transform 0.18s;
            font-size: 1.18rem;
            padding: 2.2rem 2rem 1.7rem 2rem;
            min-width: 340px;
            max-width: 520px;
            flex: 1 1 420px;
        }
        .dashboard-card:hover {
            box-shadow: 0 16px 48px rgba(33,147,176,0.28) !important;
            transform: translateY(-6px) scale(1.035);
        }
        .dashboard-list {
            scrollbar-width: thin;
            scrollbar-color: #4fc3f7 #232946;
        }
        .dashboard-list::-webkit-scrollbar {
            width: 8px;
            background: #232946;
            border-radius: 8px;
        }
        .dashboard-list::-webkit-scrollbar-thumb {
            background: #4fc3f7;
            border-radius: 8px;
        }
        .fw-bold[style*='color:#2193b0'] { color: #4fc3f7 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#1976d2'] { color: #2193b0 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#4fc3f7'] { color: #ffe066 !important; font-size: 1.25rem !important; }
        .fw-bold[style*='color:#ff9800'] { color: #ffe066 !important; font-size: 1.25rem !important; }
        .badge.bg-warning.text-dark { background: #ffe066 !important; color: #232946 !important; font-size: 1.05rem !important; }
        .dashboard-list-item a.view-details-link {
            color: #4fc3f7;
            font-weight: 500;
            text-decoration: none;
            transition: color 0.18s;
            font-size: 1.08rem;
        }
        .dashboard-list-item a.view-details-link:hover {
            color: #ffe066;
            text-decoration: underline;
        }
        @media (max-width: 1400px) {
            .dashboard-grid { max-width: 98vw; padding: 32px 8px 24px 8px !important; }
        }
        @media (max-width: 900px) {
            .dashboard-outer-container { padding: 12px 0 32px 0; }
            .dashboard-stats-card { flex-direction: column !important; gap: 18px !important; align-items: center !important; }
            .user-info-card { margin-bottom: 18px; }
            .dashboard-grid { padding: 18px 2px 12px 2px !important; }
        }
        @media (max-width: 600px) {
            .dashboard-outer-container { padding: 0 0 24px 0; }
            .dashboard-stats-card, .dashboard-card { padding: 18px 8px 14px 8px !important; }
            .dashboard-grid { padding: 8px 2px 8px 2px !important; }
        }
        @media (max-width: 1200px) {
          .dashboard-grid { grid-template-columns: 1fr !important; grid-template-rows: none !important; }
        }
        @media (max-width: 900px) {
          .dashboard-grid { grid-template-columns: 1fr !important; gap: 28px 0 !important; }
          .dashboard-card { min-width: 0 !important; max-width: 100vw !important; }
        }
        .dashboard-list-item.clickable-item {
          transition: background 0.18s, box-shadow 0.18s;
        }
        .dashboard-list-item.clickable-item:hover {
          background: rgba(79, 195, 247, 0.13);
          box-shadow: 0 2px 12px rgba(79, 195, 247, 0.12);
          border-radius: 10px;
        }

/* Light mode overrides - brighter, lighter */
body.light-mode {
  background: linear-gradient(135deg, #fafdff 0%, #d6f0fa 100%) !important;
  color: #232946;
}
body.light-mode .dashboard-unified-container,
body.light-mode .dashboard-card,
body.light-mode .dashboard-stats-card,
body.light-mode .modal-content {
  background: #fff !important;
  color: #232946 !important;
  box-shadow: 0 4px 24px rgba(33,147,176,0.08);
  border-radius: 28px;
}
body.light-mode .dashboard-stats-card {
  background: #f3faff !important;
}
body.light-mode .dashboard-list-item.clickable-item:hover {
  background: #e3f6fc !important;
}
body.light-mode .fw-bold,
body.light-mode .fw-bold[style*='color:#4fc3f7'],
body.light-mode .fw-bold[style*='color:#ffe066'],
body.light-mode .fw-bold[style*='color:#2193b0'] {
  color: #2193b0 !important;
}
body.light-mode .fw-bold[style*='color:#ffe066'],
body.light-mode .fw-bold[style*='color:#ff9800'] {
  color: #f6c90e !important;
}
body.light-mode .badge.bg-warning.text-dark {
  background: #ffe066 !important;
  color: #232946 !important;
}
body.light-mode .badge.bg-success {
  background: #27ae60 !important;
  color: #fff !important;
}
body.light-mode .badge.bg-danger {
  background: #e74c3c !important;
  color: #fff !important;
}
body.light-mode .dashboard-list-item {
  color: #232946 !important;
}
body.light-mode .dashboard-list {
  scrollbar-color: #b0e0e6 #e3f6fc;
}
body.light-mode .dashboard-list::-webkit-scrollbar-thumb {
  background: #b0e0e6;
}
        .modal-content .form-text { color: #fff !important; }
    </style>
</head>
<body>
    <header class="sticky-header">
        <div class="header-logo">ShipLink</div>
        <nav class="nav">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="/contact">Contact</a>
            {% if user.is_authenticated %}
                <a href="{% url 'logistics:dashboard' %}">Dashboard</a>
                <a href="{% url 'logistics:logout' %}">Logout</a>
            {% else %}
                <a href="/login">Login</a>
                <a href="/register">Register</a>
            {% endif %}
            <button class="dark-toggle" id="darkModeToggle" title="Toggle dark mode">🌙</button>
        </nav>
    </header>
    <div class="main-content" style="position:relative;">
        <!-- Floating SVG background -->
        <svg class="bg-illustration" viewBox="0 0 1600 900" fill="none" xmlns="http://www.w3.org/2000/svg" style="position:absolute;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:1;">
          <circle cx="200" cy="180" r="48" fill="#4fc3f7" fill-opacity="0.18">
            <animate attributeName="cy" values="180;220;180" dur="6s" repeatCount="indefinite"/>
          </circle>
          <rect x="1350" y="120" width="60" height="60" rx="18" fill="#ffe066" fill-opacity="0.13">
            <animate attributeName="y" values="120;160;120" dur="7s" repeatCount="indefinite"/>
          </rect>
          <ellipse cx="800" cy="700" rx="120" ry="40" fill="#2193b0" fill-opacity="0.10">
            <animate attributeName="cx" values="800;900;800" dur="8s" repeatCount="indefinite"/>
          </ellipse>
          <circle cx="1400" cy="600" r="32" fill="#4fc3f7" fill-opacity="0.15">
            <animate attributeName="cy" values="600;640;600" dur="5s" repeatCount="indefinite"/>
          </circle>
          <rect x="300" y="700" width="80" height="32" rx="12" fill="#ffe066" fill-opacity="0.10">
            <animate attributeName="x" values="300;350;300" dur="9s" repeatCount="indefinite"/>
          </rect>
        </svg>
        <!-- Unified Dashboard Container -->
        <div class="dashboard-unified-container mx-auto d-flex flex-column align-items-center justify-content-center" style="max-width:1400px;width:98vw;background:rgba(30,36,60,0.93);backdrop-filter:blur(18px);border-radius:36px;box-shadow:0 16px 64px rgba(33,147,176,0.22);padding:3.5rem 2.5rem 2.5rem 2.5rem;">
          <!-- User Info Row -->
          <div class="d-flex flex-column flex-md-row align-items-center justify-content-between w-100 mb-4 gap-4">
            <div class="d-flex align-items-center gap-3">
              <div class="profile-pic" style="width:90px;height:90px;border-radius:50%;background:#4fc3f7;display:flex;align-items:center;justify-content:center;font-size:2.7rem;font-weight:bold;color:#fff;box-shadow:0 2px 8px rgba(33,147,176,0.10);">
                {% if user.profile.avatar %}
                  <img src="{{ user.profile.avatar.url }}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                {% else %}
                  {{ user.username|first|upper }}
                {% endif %}
              </div>
              <div>
                <div class="fw-bold" style="font-size:1.35rem;color:#fff;">{{ user.username }}</div>
                <div class="text-muted" style="font-size:1.05rem;">user</div>
              </div>
            </div>
            <div class="d-flex flex-row gap-2 mt-3 mt-md-0">
              <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Info</button>
              <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change Password</button>
            </div>
          </div>
          <!-- Stats Bar -->
          <div class="dashboard-stats-card mb-4 w-100 d-flex flex-row justify-content-between align-items-center" style="background:rgba(20,24,40,0.98);backdrop-filter:blur(18px);border-radius:32px;box-shadow:0 16px 64px rgba(33,147,176,0.22);color:#fff;font-size:1.25rem;padding:2.5rem 2.5rem 2rem 2.5rem !important;gap:32px;">
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#ffe066;">{{ total_jobs_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Total Jobs</div>
            </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#4fc3f7;">{{ active_requests_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Active Requests</div>
            </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#ffe066;">{{ jobs_booked_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Jobs Booked</div>
            </div>
            <div style="text-align:center;flex:1;">
              <div style="font-size:2.5rem;font-weight:bold;color:#4fc3f7;">{{ liked_jobs_count }}</div>
              <div style="color:#b0b8d1;font-size:1.1rem;">Liked Jobs</div>
            </div>
          </div>
          <!-- Action Buttons -->
          <div class="dashboard-action-buttons d-flex flex-row justify-content-md-end justify-content-center align-items-center mb-4 gap-3 w-100">
            <a href="{% url 'logistics:request_job' %}" class="btn btn-lg btn-outline-info fw-bold shadow-sm dashboard-action-btn" style="border-radius: 22px; min-width: 160px; font-size: 1.13rem;">Request Job</a>
            <a href="{% url 'logistics:job_list' %}" class="btn btn-lg btn-outline-info fw-bold shadow-sm dashboard-action-btn" style="border-radius: 22px; min-width: 160px; font-size: 1.13rem;">Browse Jobs</a>
          </div>
          <!-- Dashboard Grid -->
          <div class="dashboard-grid w-100 d-grid" style="grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 48px 48px; min-height: 480px; width: 100vw; max-width: 1600px; margin: 0 auto;">
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#4fc3f7;font-size:1.25rem;">My Job Requests</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for request in job_requests %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ request.id }}" data-type="request" style="cursor:pointer;">
                    <span>
                      {{ request.title }}
                      <span class="badge ms-2
                        {% if request.status == 'pending' %}bg-warning text-dark
                        {% elif request.status == 'approved' %}bg-success
                        {% elif request.status == 'rejected' %}bg-danger
                        {% endif %}">
                        {{ request.status|capfirst }}
                      </span>
                    </span>
                  </div>
                {% empty %}
                  <div class="text-muted">No job requests found.</div>
                {% endfor %}
              </div>
            </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#2193b0;font-size:1.25rem;">Booked Jobs</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for booked in booked_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ booked.job.id }}" data-type="job" style="cursor:pointer;">
                    <span>
                      {{ booked.job.title }}
                    </span>
                  </div>
                {% empty %}
                  <div class="text-muted">No booked jobs found.</div>
                {% endfor %}
              </div>
            </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2" style="color:#ffe066;font-size:1.25rem;">Liked Jobs</div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for job in liked_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ job.id }}" data-type="job" style="cursor:pointer;">
                    <span>
                      {{ job.title }}
                    </span>
                  </div>
                {% empty %}
                  <div class="text-muted">No liked jobs found.</div>
                {% endfor %}
              </div>
            </div>
            <div class="dashboard-card h-100 d-flex flex-column">
              <div class="fw-bold mb-2 d-flex align-items-center" style="color:#ffe066;font-size:1.25rem;"><span style="font-size:1.2rem;">&#128161;</span><span class="ms-2">Recommended Jobs</span></div>
              <div class="dashboard-list flex-grow-1" style="overflow-y:auto;max-height:260px;">
                {% for job in recommended_jobs %}
                  <div class="dashboard-list-item d-flex justify-content-between align-items-center mb-2 clickable-item" data-id="{{ job.id }}" data-type="job" style="cursor:pointer;">
                    <span>
                      {{ job.title }}
                    </span>
                  </div>
                {% empty %}
                  <div class="text-muted">No recommended jobs found.</div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="jobDetailModal" tabindex="-1" aria-labelledby="jobDetailModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background:rgba(35,41,70,0.98);color:#fff;border-radius:18px;box-shadow:0 8px 40px rgba(33,147,176,0.18);">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="jobDetailModalLabel">Job Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" id="jobDetailModalBody">
                <div class="text-center text-muted">Loading...</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Edit Profile Modal -->
        <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:rgba(35,41,70,0.97);color:#fff;border-radius:18px;box-shadow:0 8px 40px rgba(33,147,176,0.18);">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="editProfileForm" method="post" action="{% url 'logistics:edit_profile' %}">
                  {% csrf_token %}
                  <div class="mb-3">
                    <label for="id_username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="id_username" name="username" value="{{ user.username }}" required pattern="^[a-zA-Z0-9_]{3,30}$" minlength="3" maxlength="30">
                    <div class="form-text">3-30 characters, letters, numbers, and underscores only.</div>
                  </div>
                  <div class="mb-3">
                    <label for="id_first_name" class="form-label">First name</label>
                    <input type="text" class="form-control" id="id_first_name" name="first_name" value="{{ user.first_name }}" required minlength="2" maxlength="30">
                    <div class="form-text">2-30 characters.</div>
                  </div>
                  <div class="mb-3">
                    <label for="id_last_name" class="form-label">Last name</label>
                    <input type="text" class="form-control" id="id_last_name" name="last_name" value="{{ user.last_name }}" required minlength="2" maxlength="30">
                    <div class="form-text">2-30 characters.</div>
                  </div>
                  <div class="mb-3">
                    <label for="id_email" class="form-label">Email address</label>
                    <input type="email" class="form-control" id="id_email" name="email" value="{{ user.email }}" required maxlength="254">
                    <div class="form-text">Must be a valid email address.</div>
                  </div>
                  <div id="editProfileMsg" class="mb-2"></div>
                  <button type="submit" class="btn btn-warning w-100">Save Changes</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- Change Password Modal -->
        <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background:rgba(35,41,70,0.97);color:#fff;border-radius:18px;box-shadow:0 8px 40px rgba(33,147,176,0.18);">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="changePasswordForm" method="post" action="{% url 'logistics:change_password' %}">
                  {% csrf_token %}
                  <div class="mb-3">
                    <label for="id_old_password" class="form-label">Current Password</label>
                    <input type="password" class="form-control" id="id_old_password" name="old_password" required>
                  </div>
                  <div class="mb-3">
                    <label for="id_new_password1" class="form-label">New Password</label>
                    <input type="password" class="form-control" id="id_new_password1" name="new_password1" required minlength="8" maxlength="128">
                    <div class="form-text">At least 8 characters.</div>
                  </div>
                  <div class="mb-3">
                    <label for="id_new_password2" class="form-label">Confirm New Password</label>
                    <input type="password" class="form-control" id="id_new_password2" name="new_password2" required minlength="8" maxlength="128">
                  </div>
                  <div id="changePasswordMsg" class="mb-2"></div>
                  <button type="submit" class="btn btn-warning w-100">Change Password</button>
                </form>
              </div>
            </div>
          </div>
        </div>
    </div>
    <footer class="footer mt-auto">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-auto">
                    &copy; 2025 ShipLink. All rights reserved.
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    function setDarkMode(on) {
        if(on) {
            document.documentElement.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'on');
        } else {
            document.documentElement.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'off');
        }
    }
    function getDarkMode() {
        const pref = localStorage.getItem('darkMode');
        if (pref === null) {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        return pref === 'on';
    }
    document.getElementById('darkModeToggle').onclick = function() {
        const on = !getDarkMode();
        setDarkMode(on);
        this.textContent = on ? '☀️' : '🌙';
    };
    setDarkMode(getDarkMode());
    document.getElementById('darkModeToggle').textContent = getDarkMode() ? '☀️' : '🌙';
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
  const modal = new bootstrap.Modal(document.getElementById('jobDetailModal'));
  document.querySelectorAll('.clickable-item').forEach(item => {
    item.addEventListener('click', function(e) {
      const id = this.getAttribute('data-id');
      const type = this.getAttribute('data-type');
      const url = type === 'request' ? `/requests/${id}/json/` : `/jobs/${id}/json/`;
      document.getElementById('jobDetailModalBody').innerHTML = '<div class="text-center text-muted">Loading...</div>';
      modal.show();
      fetch(url)
        .then(resp => resp.json())
        .then(data => {
          let html = '';
          if (type === 'job') {
            html += `<h4>${data.title}</h4>`;
            html += `<div><b>Description:</b> ${data.description || '—'}</div>`;
            html += `<div><b>Origin:</b> ${data.origin} (${data.origin_address || '—'}, ${data.origin_zip || '—'})</div>`;
            html += `<div><b>Destination:</b> ${data.destination} (${data.destination_address || '—'}, ${data.destination_zip || '—'})</div>`;
            html += `<div><b>Pickup Date:</b> ${data.pickup_date || '—'}</div>`;
            html += `<div><b>Pickup Time:</b> ${data.pickup_time_from || '—'} - ${data.pickup_time_to || '—'}</div>`;
            html += `<div><b>Delivery Deadline:</b> ${data.delivery_deadline || '—'}</div>`;
            html += `<div><b>Cargo Type:</b> ${data.cargo_type || '—'}</div>`;
            html += `<div><b>Weight:</b> ${data.weight_kg || '—'} kg</div>`;
            html += `<div><b>Dimensions:</b> ${data.length_cm || '—'} × ${data.width_cm || '—'} × ${data.height_cm || '—'} cm</div>`;
            html += `<div><b>Special Requirements:</b> ${data.special_requirements || '—'}</div>`;
            html += `<div><b>Declared Value:</b> ${data.declared_value || '—'}</div>`;
            html += `<div><b>Reference Code:</b> ${data.reference_code || '—'}</div>`;
            html += `<div><b>Created At:</b> ${data.created_at || '—'}</div>`;
          } else {
            html += `<h4>Request: ${data.origin} → ${data.destination}</h4>`;
            html += `<div><b>Status:</b> ${data.status || '—'}</div>`;
            html += `<div><b>Notes:</b> ${data.staff_note || '—'}</div>`;
            html += `<div><b>Declared Value:</b> ${data.declared_value || '—'}</div>`;
            html += `<div><b>Created:</b> ${data.created_at || '—'}</div>`;
          }
          document.getElementById('jobDetailModalBody').innerHTML = html;
        })
        .catch(() => {
          document.getElementById('jobDetailModalBody').innerHTML = '<div class="text-danger">Failed to load details.</div>';
        });
    });
  });
});
</script>
<script>
// AJAX for Edit Profile Modal
$(document).ready(function() {
  $('#editProfileForm').on('submit', function(e) {
    e.preventDefault();
    var $form = $(this);
    var $msg = $('#editProfileMsg');
    $.ajax({
      url: $form.attr('action'),
      type: 'POST',
      data: $form.serialize(),
      success: function(data) {
        if (data.success) {
          $msg.html('<div class="alert alert-success">Profile updated!</div>');
          setTimeout(function() { $('#editProfileModal').modal('hide'); location.reload(); }, 1200);
        } else {
          $msg.html('<div class="alert alert-danger">' + (data.error || 'Update failed.') + '</div>');
        }
      },
      error: function(xhr) {
        $msg.html('<div class="alert alert-danger">' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Update failed.') + '</div>');
      }
    });
  });
});
</script>
<script>
// AJAX for Change Password Modal
$(document).ready(function() {
  $('#changePasswordForm').on('submit', function(e) {
    e.preventDefault();
    var $form = $(this);
    var $msg = $('#changePasswordMsg');
    $.ajax({
      url: $form.attr('action'),
      type: 'POST',
      data: $form.serialize(),
      success: function(data) {
        if (data.success) {
          $msg.html('<div class="alert alert-success">Password changed!</div>');
          setTimeout(function() { $('#changePasswordModal').modal('hide'); location.reload(); }, 1200);
        } else {
          $msg.html('<div class="alert alert-danger">' + (data.error || 'Change failed.') + '</div>');
        }
      },
      error: function(xhr) {
        $msg.html('<div class="alert alert-danger">' + (xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Change failed.') + '</div>');
      }
    });
  });
});
</script>
</body>
</html> 